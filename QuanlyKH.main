package qlkh;

import java.io.IOException;
import java.time.LocalDate;
import java.util.Arrays;

public class Main {
    public static void main(String[] args) {
        DanhSachKhachHang ds = new DanhSachKhachHang();

        //1. ƒê·ªåC D·ªÆ LI·ªÜU T·ª™ FILE
        try {
            ds.docFile("khachhang.txt");   // ho·∫∑c "kh.txt" n·∫øu b·∫°n ƒë·∫∑t t√™n v·∫≠y
            System.out.println(" ƒê·ªçc d·ªØ li·ªáu t·ª´ file th√†nh c√¥ng!");
        } catch (IOException e) {
            System.out.println("Kh√¥ng t√¨m th·∫•y file khachhang.txt, t·∫°o d·ªØ li·ªáu m·∫´u...");
            
            //2. T·∫†O D·ªÆ LI·ªÜU M·∫™U
            KhachHang kh1 = new KhachHang(KhachHangHelper.sinhMaKhachHang(), "Nguyen Van A", "0901234567", "a@gmail.com",
                    LocalDate.of(1995, 12, 20), 800, "V√†ng", Arrays.asList("DH001", "DH002"));
            KhachHangVIP kh2 = new KhachHangVIP(KhachHangHelper.sinhMaKhachHang(), "Tran Thi B", "0912345678", "b@gmail.com",
                    LocalDate.of(1990, 11, 5), 1500, "VIP", Arrays.asList("DH003", "DH004"), 0.15);
            KhachHangTiemNang kh3 = new KhachHangTiemNang(KhachHangHelper.sinhMaKhachHang(), "Le Van C", "0987654321",
                    "c@gmail.com", LocalDate.of(2000, 10, 30));

            ds.them(kh1);
            ds.them(kh2);
            ds.them(kh3);

            // Ghi l·∫°i d·ªØ li·ªáu m·∫´u v√†o file ƒë·ªÉ l·∫ßn sau ƒë·ªçc
            try {
                ds.ghiFile("khachhang.txt");
                System.out.println("üíæ ƒê√£ t·∫°o file khachhang.txt v·ªõi d·ªØ li·ªáu m·∫´u!");
            } catch (IOException ex) {
                System.out.println("L·ªói ghi file: " + ex.getMessage());
            }
        }

        //3. HI·ªÇN TH·ªä DANH S√ÅCH
        System.out.println("\n=== DANH S√ÅCH KH√ÅCH H√ÄNG ===");
        ds.xuat();

        //4. TH·ªêNG K√ä KH√ÅCH VIP
        System.out.println("\n=== KH√ÅCH H√ÄNG VIP ===");
        ds.thongKeVIP().forEach(KhachHang::xuat);

        //5. T√åM KH√ÅCH G·∫¶N ƒê√öNG T√äN
        System.out.println("\n=== T√åM T√äN G·∫¶N ƒê√öNG (vd: 'Nguyen Van A') ===");
        ds.timGanDungTen("Nguyen Van A").forEach(KhachHang::xuat);

        //6. KH√ÅCH MUA NHI·ªÄU NH·∫§T 
        System.out.println("\n=== KH√ÅCH MUA NHI·ªÄU NH·∫§T ===");
        KhachHang khMax = ds.khachMuaNhieuNhat();
        if (khMax != null) khMax.xuat();

        System.out.println("\n Ch∆∞∆°ng tr√¨nh ch·∫°y ho√†n t·∫•t!");
    }
}
